#######################################################################

# Use ubuntu trusty (14.04) with sudo privileges.
dist: trusty
sudo: required
language:
  - generic
compiler:
  - gcc
cache:
  - apt

# Configuration variables. All variables are global now, but this can be used to
# trigger a build matrix for different ROS distributions if desired.
env:
  global:
    - ROS_DISTRO=indigo
    - ROS_CI_DESKTOP="`lsb_release -cs`"  # e.g. [precise|trusty|...]
    - CI_SOURCE_PATH=$(pwd)
    - ROS_PARALLEL_JOBS='-j8 -l6'

################################################################################

# Compile and test (mark the build as failed if any step fails).
#
# NOTE on testing: `catkin_make run_tests` will show the output of the tests
# (gtest, nosetest, etc..) but always returns 0 (success) even if a test
# fails. Running `catkin_test_results` aggregates all the results and returns
# non-zero when a test fails (which notifies Travis the build failed).
script:
  - source /opt/ros/$ROS_DISTRO/setup.bash
  - $CI_SOURCE_PATH/setup/setup_indigo.sh
  - cd ~/costar_ws/src
  # Add the package under integration to the workspace using a symlink.
  - ln -s $CI_SOURCE_PATH .
  - rosdep install -y --from-paths ./ --ignore-src --rosdistro $ROS_DISTRO
  - cd ~/costar_ws
  - catkin build --verbose
  # Run the tests, ensuring the path is set correctly.
  - source devel/setup.bash
  # =========================================================
  #TODO: fix tests; something wrong with TF
  - $CI_SOURCE_PATH/costar_task_plan/tests/task_test.py
  - $CI_SOURCE_PATH/costar_task_plan/tests/cem_test.py
  - $CI_SOURCE_PATH/costar_bullet/scripts/start --task blocks --robot ur5 --agent task --features null
